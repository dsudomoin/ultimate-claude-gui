# ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚ Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ IntelliJ-Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° Claude Code GUI (Kotlin-Ğ²ĞµÑ€ÑĞ¸Ñ)

## ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚

Ğ¢Ñ‹ â€” Ğ¾Ğ¿Ñ‹Ñ‚Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº IntelliJ-Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ². Ğ¢ĞµĞ±Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ IntelliJ IDEA Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½ Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ AI-Ğ´Ğ²Ğ¸Ğ¶ĞºĞ°Ğ¼Ğ¸ (Claude Code, OpenAI Codex) **Ñ Ğ½ÑƒĞ»Ñ**, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑ **Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ ÑÑ‚ĞµĞº IntelliJ Platform**: Kotlin, Coroutines, Swing/IntelliJ UI DSL. ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ÑƒÑ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° Java + JCEF (Chromium webview) + React + Node.js bridge, ÑƒÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ğ² Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ ÑĞ»Ğ°Ğ±Ğ¾ÑÑ‚Ğ¸ Ğ¸ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¿Ğ¾Ğ²Ñ‹ÑĞ¸Ğ² Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ, ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¸ ÑƒĞ´Ğ¾Ğ±ÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¸.

---

## ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼

Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ¼ĞµĞµÑ‚ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:

1. **JCEF (Chromium) Ñ‚ÑĞ¶ĞµĞ»Ğ¾Ğ²ĞµÑĞµĞ½** â€” ĞºĞ°Ğ¶Ğ´Ğ°Ñ Ğ²ĞºĞ»Ğ°Ğ´ĞºĞ° Ñ‡Ğ°Ñ‚Ğ° Ğ¿Ğ¾Ğ´Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ (~150â€“300 MB RAM), ÑĞ»ÑƒÑ‡Ğ°ÑÑ‚ÑÑ ĞºÑ€ÑÑˆĞ¸, OSR-Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ Ğ½ĞµÑÑ‚Ğ°Ğ±Ğ¸Ğ»ĞµĞ½ Ğ½Ğ° Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… ĞĞ¡.
2. **Node.js bridge** â€” Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ ÑĞ¿Ğ°Ğ²Ğ½Ğ¸Ñ‚ÑÑ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Node-Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ (`node channel-manager.js`), IPC Ñ‡ĞµÑ€ĞµĞ· stdin/stdout â€” Ñ…Ñ€ÑƒĞ¿ĞºĞ¾, Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾, ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ñ‚Ğ»Ğ°Ğ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ.
3. **Ğ¢Ñ€Ğ¸ Ñ€Ğ°Ğ½Ñ‚Ğ°Ğ¹Ğ¼Ğ°** (JVM + Chromium + Node.js) â€” Ğ¾Ğ³Ñ€Ğ¾Ğ¼Ğ½Ñ‹Ğ¹ overhead Ğ¿Ğ¾ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸, CPU Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ñ…Ğ¾Ğ»Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ ÑÑ‚Ğ°Ñ€Ñ‚Ğ°.
4. **React/TypeScript/Ant Design webview** (~214 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²) â€” Ğ¸Ğ·Ğ±Ñ‹Ñ‚Ğ¾Ñ‡ĞµĞ½ Ğ´Ğ»Ñ tool window IDE, Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ ÑˆÑ€Ğ¸Ñ„Ñ‚Ğ¾Ğ², ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹ Ñ‚ĞµĞ¼, accessibility.
5. **JSON IPC Ñ‡ĞµÑ€ĞµĞ· JSâ†”Java Ğ¼Ğ¾ÑÑ‚** â€” Ñ‚ĞµÑ€ÑÑÑ‚ÑÑ Ñ‚Ğ¸Ğ¿Ñ‹, Ğ»ĞµĞ³ĞºĞ¾ Ñ€Ğ°ÑÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ», ÑĞ»Ğ¾Ğ¶Ğ½Ğ°Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ°.
6. **Ğ”Ğ²Ğ¾Ğ¹Ğ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ĞµĞ¼** â€” React state + Java session state Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ.

---

## Ğ¦ĞµĞ»ĞµĞ²Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### Ğ¡Ñ‚ĞµĞº Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¹

| Ğ¡Ğ»Ğ¾Ğ¹ | Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ |
|------|-----------|
| Ğ¯Ğ·Ñ‹Ğº | **Kotlin 2.x** (100% Kotlin, Ğ±ĞµĞ· Java) |
| ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ | **Kotlin Coroutines** + `Flow` Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ° |
| UI | **IntelliJ Platform UI** â€” Swing + IntelliJ UI DSL 2.0 (`com.intellij.ui.dsl.builder`) |
| Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ Markdown | **IntelliJ Markdown** (`org.intellij.plugins.markdown`) Ğ¸Ğ»Ğ¸ Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğ¹ `JEditorPane`/`JBHtmlPane` Ñ Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ¾Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸ÑĞ° Ñ‡ĞµÑ€ĞµĞ· IntelliJ `EditorHighlighter` |
| ĞŸĞ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° ĞºĞ¾Ğ´Ğ° | **IntelliJ Editor API** â€” Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ `EditorFragment` Ğ´Ğ»Ñ code blocks |
| HTTP-ĞºĞ»Ğ¸ĞµĞ½Ñ‚ | **Ktor Client** Ğ¸Ğ»Ğ¸ **OkHttp** (Ğ´Ğ»Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… API-Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ² Ğº Anthropic/OpenAI) |
| Ğ¡ĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ | **kotlinx.serialization** (JSON) |
| DI | **IntelliJ Service API** (`@Service`, `service<T>()`) |
| Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ | **IntelliJ PersistentStateComponent** Ğ´Ğ»Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº, Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´Ğ»Ñ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ |
| Diff | **IntelliJ DiffManager API** (Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ diff viewer) |
| MCP | ĞŸÑ€ÑĞ¼Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° Kotlin (stdio/SSE/HTTP Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ñ‹) |
| ĞŸÑ€Ğ¾Ñ†ĞµÑÑÑ‹ | **`GeneralCommandLine` + `ProcessHandler`** Ğ¸Ğ· IntelliJ Platform |

### ĞšĞ»ÑÑ‡ĞµĞ²Ğ¾Ğµ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ¾Ñ‚ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸

**ĞĞµÑ‚ JCEF, Ğ½ĞµÑ‚ Node.js, Ğ½ĞµÑ‚ React.** Ğ’ĞµÑÑŒ UI â€” Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Swing Ñ‡ĞµÑ€ĞµĞ· IntelliJ Platform API. Ğ’ÑĞµ ÑĞµÑ‚ĞµĞ²Ñ‹Ğµ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹ â€” Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ Ğ¸Ğ· JVM Ñ‡ĞµÑ€ĞµĞ· HTTP-ĞºĞ»Ğ¸ĞµĞ½Ñ‚. MCP-ÑĞµÑ€Ğ²ĞµÑ€Ñ‹ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ Ğ¸Ğ· Kotlin.

---

## Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```
src/main/kotlin/com/github/claudecodegui/
â”œâ”€â”€ plugin/                          # Plugin lifecycle
â”‚   â”œâ”€â”€ ClaudeCodePlugin.kt         # Plugin entry point
â”‚   â””â”€â”€ StartupActivity.kt          # Post-startup initialization
â”‚
â”œâ”€â”€ core/                            # Core domain
â”‚   â”œâ”€â”€ model/                       # Domain models
â”‚   â”‚   â”œâ”€â”€ Message.kt              # Chat message (role, content blocks, metadata)
â”‚   â”‚   â”œâ”€â”€ ContentBlock.kt         # Text, Code, ToolUse, ToolResult, Thinking
â”‚   â”‚   â”œâ”€â”€ Conversation.kt         # Conversation state (messages, sessionId, metadata)
â”‚   â”‚   â”œâ”€â”€ Provider.kt             # sealed class: Claude, Codex
â”‚   â”‚   â”œâ”€â”€ ToolCall.kt             # Tool invocation model
â”‚   â”‚   â”œâ”€â”€ Permission.kt           # Permission request/decision
â”‚   â”‚   â””â”€â”€ McpServer.kt            # MCP server config
â”‚   â”‚
â”‚   â”œâ”€â”€ session/                     # Session management
â”‚   â”‚   â”œâ”€â”€ SessionManager.kt       # Create/load/switch/delete sessions
â”‚   â”‚   â”œâ”€â”€ SessionStorage.kt       # JSONL persistence
â”‚   â”‚   â””â”€â”€ SessionState.kt         # Reactive session state (StateFlow)
â”‚   â”‚
â”‚   â””â”€â”€ context/                     # IDE context collection
â”‚       â”œâ”€â”€ EditorContextCollector.kt    # Active file, selection, caret position
â”‚       â”œâ”€â”€ JavaContextCollector.kt      # Java/Kotlin PSI analysis
â”‚       â”œâ”€â”€ PythonContextCollector.kt    # Python PSI analysis
â”‚       â””â”€â”€ ProjectContextCollector.kt   # Git status, project structure
â”‚
â”œâ”€â”€ provider/                        # AI Provider abstraction
â”‚   â”œâ”€â”€ AiProvider.kt               # interface: sendMessage(), streamResponse()
â”‚   â”œâ”€â”€ ProviderFactory.kt          # Create provider by type
â”‚   â”‚
â”‚   â”œâ”€â”€ claude/                      # Claude implementation
â”‚   â”‚   â”œâ”€â”€ ClaudeProvider.kt       # Anthropic Messages API client
â”‚   â”‚   â”œâ”€â”€ ClaudeStreamParser.kt   # SSE stream parser â†’ Flow<StreamEvent>
â”‚   â”‚   â”œâ”€â”€ ClaudeToolExecutor.kt   # Execute tools (Write, Edit, Bash, etc.)
â”‚   â”‚   â””â”€â”€ ClaudeModels.kt         # Available models enum
â”‚   â”‚
â”‚   â””â”€â”€ codex/                       # Codex implementation
â”‚       â”œâ”€â”€ CodexProvider.kt         # OpenAI Chat Completions API client
â”‚       â”œâ”€â”€ CodexStreamParser.kt     # SSE stream parser â†’ Flow<StreamEvent>
â”‚       â””â”€â”€ CodexModels.kt          # Available models enum
â”‚
â”œâ”€â”€ tool/                            # Tool system (agentic)
â”‚   â”œâ”€â”€ Tool.kt                     # sealed interface for all tools
â”‚   â”œâ”€â”€ ToolRegistry.kt             # Register and lookup tools
â”‚   â”œâ”€â”€ ToolExecutor.kt             # Execute tool with permission check
â”‚   â”‚
â”‚   â”œâ”€â”€ impl/                        # Built-in tool implementations
â”‚   â”‚   â”œâ”€â”€ ReadFileTool.kt
â”‚   â”‚   â”œâ”€â”€ WriteFileTool.kt
â”‚   â”‚   â”œâ”€â”€ EditFileTool.kt
â”‚   â”‚   â”œâ”€â”€ BashTool.kt
â”‚   â”‚   â”œâ”€â”€ GlobTool.kt
â”‚   â”‚   â”œâ”€â”€ GrepTool.kt
â”‚   â”‚   â”œâ”€â”€ WebFetchTool.kt
â”‚   â”‚   â””â”€â”€ SubagentTool.kt
â”‚   â”‚
â”‚   â””â”€â”€ permission/                  # Permission system
â”‚       â”œâ”€â”€ PermissionService.kt     # Check/request permissions
â”‚       â”œâ”€â”€ PermissionRule.kt        # Rules: always allow, always deny, ask
â”‚       â””â”€â”€ PermissionStorage.kt     # Persist permission decisions
â”‚
â”œâ”€â”€ mcp/                             # MCP (Model Context Protocol) client
â”‚   â”œâ”€â”€ McpClient.kt                # Main client: connect, list tools, call tool
â”‚   â”œâ”€â”€ McpTransport.kt             # sealed class: Stdio, Sse, Http
â”‚   â”œâ”€â”€ McpStdioTransport.kt        # Stdio transport implementation
â”‚   â”œâ”€â”€ McpSseTransport.kt          # SSE transport implementation
â”‚   â”œâ”€â”€ McpHttpTransport.kt         # HTTP transport implementation
â”‚   â”œâ”€â”€ McpServerManager.kt         # Lifecycle: start, stop, validate servers
â”‚   â””â”€â”€ McpProtocol.kt              # JSON-RPC protocol messages
â”‚
â”œâ”€â”€ ui/                              # UI layer (all native Swing/IntelliJ)
â”‚   â”œâ”€â”€ toolwindow/
â”‚   â”‚   â”œâ”€â”€ ClaudeToolWindowFactory.kt   # ToolWindowFactory registration
â”‚   â”‚   â””â”€â”€ ClaudeToolWindow.kt          # Main tool window with tabs
â”‚   â”‚
â”‚   â”œâ”€â”€ chat/                        # Chat panel
â”‚   â”‚   â”œâ”€â”€ ChatPanel.kt            # Main chat panel (message list + input)
â”‚   â”‚   â”œâ”€â”€ MessageListPanel.kt     # Scrollable message list (virtual/lazy)
â”‚   â”‚   â”œâ”€â”€ MessageBubble.kt        # Single message render (markdown + code)
â”‚   â”‚   â”œâ”€â”€ CodeBlockPanel.kt       # Code block with syntax highlighting
â”‚   â”‚   â”œâ”€â”€ ThinkingPanel.kt        # Collapsible thinking/reasoning block
â”‚   â”‚   â”œâ”€â”€ ToolCallPanel.kt        # Tool invocation display
â”‚   â”‚   â””â”€â”€ StreamingIndicator.kt   # Typing/streaming animation
â”‚   â”‚
â”‚   â”œâ”€â”€ input/                       # Input area
â”‚   â”‚   â”œâ”€â”€ ChatInputPanel.kt       # Multi-line input with attachments
â”‚   â”‚   â”œâ”€â”€ AttachmentBar.kt        # File/image attachment chips
â”‚   â”‚   â”œâ”€â”€ SlashCommandPopup.kt    # Autocomplete for /commands
â”‚   â”‚   â”œâ”€â”€ FileReferencePopup.kt   # Autocomplete for @file references
â”‚   â”‚   â””â”€â”€ ModelSelector.kt        # Provider + model dropdown
â”‚   â”‚
â”‚   â”œâ”€â”€ dialog/                      # Dialogs
â”‚   â”‚   â”œâ”€â”€ PermissionDialog.kt     # Tool permission approval
â”‚   â”‚   â”œâ”€â”€ PlanApprovalDialog.kt   # Plan review and approval
â”‚   â”‚   â”œâ”€â”€ AskUserDialog.kt        # AI asks user a question
â”‚   â”‚   â””â”€â”€ RewindDialog.kt         # Conversation rewind selection
â”‚   â”‚
â”‚   â”œâ”€â”€ diff/                        # Diff integration
â”‚   â”‚   â”œâ”€â”€ InlineDiffPanel.kt      # Inline diff preview in chat
â”‚   â”‚   â””â”€â”€ DiffApplyAction.kt      # Apply/discard diff actions
â”‚   â”‚
â”‚   â”œâ”€â”€ settings/                    # Settings UI
â”‚   â”‚   â”œâ”€â”€ ClaudeSettingsConfigurable.kt  # Settings page entry
â”‚   â”‚   â”œâ”€â”€ ProviderSettingsPanel.kt       # API keys, models, endpoints
â”‚   â”‚   â”œâ”€â”€ McpSettingsPanel.kt            # MCP server management
â”‚   â”‚   â”œâ”€â”€ PermissionSettingsPanel.kt     # Permission rules
â”‚   â”‚   â”œâ”€â”€ PromptSettingsPanel.kt         # System prompts
â”‚   â”‚   â””â”€â”€ AppearanceSettingsPanel.kt     # Theme, font, language
â”‚   â”‚
â”‚   â”œâ”€â”€ status/                      # Status panel
â”‚   â”‚   â”œâ”€â”€ StatusPanel.kt          # Multi-tab status (tasks, agents, changes)
â”‚   â”‚   â”œâ”€â”€ TasksTab.kt             # Current tasks
â”‚   â”‚   â”œâ”€â”€ AgentTab.kt             # Subagent execution log
â”‚   â”‚   â””â”€â”€ ChangesTab.kt           # File changes list
â”‚   â”‚
â”‚   â”œâ”€â”€ history/                     # Session history
â”‚   â”‚   â”œâ”€â”€ HistoryPanel.kt         # Session list with search
â”‚   â”‚   â””â”€â”€ SessionPreviewPanel.kt  # Session detail/preview
â”‚   â”‚
â”‚   â””â”€â”€ common/                      # Reusable UI components
â”‚       â”œâ”€â”€ MarkdownRenderer.kt     # Markdown â†’ Swing component tree
â”‚       â”œâ”€â”€ SyntaxHighlighter.kt    # Code highlighting via IntelliJ
â”‚       â”œâ”€â”€ AnimatedPanel.kt        # Expandable/collapsible panels
â”‚       â”œâ”€â”€ TokenCounter.kt         # Token usage display
â”‚       â””â”€â”€ ThemeSync.kt            # IDE theme â†” chat theme sync
â”‚
â”œâ”€â”€ action/                          # IDE Actions
â”‚   â”œâ”€â”€ SendSelectionAction.kt      # Ctrl+Alt+K â€” send selection to chat
â”‚   â”œâ”€â”€ QuickFixAction.kt           # Ctrl+Shift+Q â€” quick fix with AI
â”‚   â”œâ”€â”€ SendFilePathAction.kt       # Right-click â†’ send file path
â”‚   â”œâ”€â”€ GenerateCommitAction.kt     # Generate commit message
â”‚   â””â”€â”€ NewTabAction.kt             # Create new chat tab
â”‚
â”œâ”€â”€ service/                         # Application/project services
â”‚   â”œâ”€â”€ SettingsService.kt          # PersistentStateComponent for config
â”‚   â”œâ”€â”€ ConversationService.kt      # Manage active conversations
â”‚   â”œâ”€â”€ ProviderService.kt          # Manage AI provider state
â”‚   â”œâ”€â”€ DependencyService.kt        # Check/install SDK dependencies
â”‚   â””â”€â”€ NotificationService.kt      # IDE notifications
â”‚
â”œâ”€â”€ config/                          # Configuration
â”‚   â”œâ”€â”€ PluginConfig.kt             # Plugin-wide config data class
â”‚   â”œâ”€â”€ ProviderConfig.kt           # Per-provider config (API key, model, etc.)
â”‚   â””â”€â”€ McpConfig.kt                # MCP server configurations
â”‚
â””â”€â”€ util/                            # Utilities
    â”œâ”€â”€ CoroutineScopes.kt          # Plugin-scoped coroutine contexts
    â”œâ”€â”€ JsonUtils.kt                # kotlinx.serialization helpers
    â”œâ”€â”€ FileUtils.kt                # VirtualFile helpers
    â”œâ”€â”€ GitUtils.kt                 # Git operations via IntelliJ VCS API
    â””â”€â”€ PlatformUtils.kt           # OS detection, path resolution
```

---

## Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²

### 1. AI Provider Layer

```kotlin
// provider/AiProvider.kt
interface AiProvider {
    val id: String
    val displayName: String
    val availableModels: List<AiModel>

    /**
     * ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ¸Ğ¼ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°.
     * Flow ÑĞ¼Ğ¸Ñ‚Ğ¸Ñ‚ StreamEvent Ğ¿Ğ¾ Ğ¼ĞµÑ€Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ¾Ñ‚ API.
     */
    fun sendMessage(
        conversation: Conversation,
        config: ProviderConfig,
        tools: List<ToolDefinition> = emptyList(),
        mcpTools: List<McpToolDefinition> = emptyList()
    ): Flow<StreamEvent>

    fun cancelCurrentRequest()
}

// Ğ¡Ñ‚Ñ€Ğ¸Ğ¼-ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
sealed class StreamEvent {
    data class TextDelta(val text: String) : StreamEvent()
    data class ThinkingDelta(val text: String) : StreamEvent()
    data class ToolUse(val id: String, val name: String, val input: JsonObject) : StreamEvent()
    data class ToolResult(val id: String, val content: String, val isError: Boolean) : StreamEvent()
    data class Usage(val inputTokens: Int, val outputTokens: Int, val cacheRead: Int = 0) : StreamEvent()
    data class Error(val message: String, val code: String? = null) : StreamEvent()
    data object StreamStart : StreamEvent()
    data object StreamEnd : StreamEvent()
    data object MessageStop : StreamEvent()
}
```

#### Claude Provider â€” Ğ¿Ñ€ÑĞ¼Ñ‹Ğµ HTTP-Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹

```kotlin
// provider/claude/ClaudeProvider.kt
class ClaudeProvider(private val httpClient: HttpClient) : AiProvider {

    override fun sendMessage(
        conversation: Conversation,
        config: ProviderConfig,
        tools: List<ToolDefinition>,
        mcpTools: List<McpToolDefinition>
    ): Flow<StreamEvent> = flow {
        val request = buildAnthropicRequest(conversation, config, tools + mcpTools)

        // SSE streaming Ñ‡ĞµÑ€ĞµĞ· Ktor/OkHttp
        httpClient.preparePost("${config.baseUrl}/v1/messages") {
            header("x-api-key", config.apiKey)
            header("anthropic-version", "2023-06-01")
            contentType(ContentType.Application.Json)
            setBody(Json.encodeToString(request))
        }.execute { response ->
            val channel = response.bodyAsChannel()
            // ĞŸĞ°Ñ€ÑĞ¸Ğ¼ SSE: data: {...}\n\n
            channel.parseSSE().collect { event ->
                emit(parseStreamEvent(event))
            }
        }
    }.flowOn(Dispatchers.IO)
}
```

> **Ğ’Ğ°Ğ¶Ğ½Ğ¾**: ĞĞ¸ĞºĞ°ĞºĞ¾Ğ³Ğ¾ Node.js. ĞŸÑ€ÑĞ¼Ñ‹Ğµ HTTP-Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹ Ğº `api.anthropic.com` Ñ‡ĞµÑ€ĞµĞ· Ktor Client Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹ SSE-ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ°. Ğ¢Ğ¾ Ğ¶Ğµ ÑĞ°Ğ¼Ğ¾Ğµ Ğ´Ğ»Ñ OpenAI.

### 2. Agentic Loop (Tool Execution)

```kotlin
// tool/AgenticLoop.kt
class AgenticLoop(
    private val provider: AiProvider,
    private val toolExecutor: ToolExecutor,
    private val permissionService: PermissionService,
    private val scope: CoroutineScope
) {
    /**
     * ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ†Ğ¸ĞºĞ» Ğ°Ğ³ĞµĞ½Ñ‚Ğ°:
     * 1. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ â†’ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚
     * 2. Ğ•ÑĞ»Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ tool_use â†’ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚
     * 3. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ tool_result â†’ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ½Ğ¾Ğ²Ğ°
     * 4. ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑ‚ÑŒ Ğ¿Ğ¾ĞºĞ° AI Ğ½Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ (stop_reason != "tool_use")
     */
    fun run(
        conversation: Conversation,
        config: ProviderConfig,
        onEvent: suspend (StreamEvent) -> Unit
    ): Flow<AgentEvent> = flow {
        var currentConversation = conversation
        var continueLoop = true

        while (continueLoop) {
            val toolCalls = mutableListOf<ToolCall>()

            provider.sendMessage(currentConversation, config, getTools())
                .collect { event ->
                    onEvent(event)
                    when (event) {
                        is StreamEvent.ToolUse -> toolCalls.add(ToolCall(event.id, event.name, event.input))
                        is StreamEvent.MessageStop -> continueLoop = false
                        is StreamEvent.StreamEnd -> {
                            if (toolCalls.isNotEmpty()) {
                                // Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ tool calls
                                val results = toolCalls.map { call ->
                                    executeToolWithPermission(call)
                                }
                                // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ² conversation Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ
                                currentConversation = currentConversation.addToolResults(results)
                                continueLoop = true
                            }
                        }
                        else -> {}
                    }
                }
        }
    }

    private suspend fun executeToolWithPermission(call: ToolCall): ToolResult {
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ
        val decision = permissionService.checkPermission(call)
        return when (decision) {
            PermissionDecision.ALLOW -> toolExecutor.execute(call)
            PermissionDecision.DENY -> ToolResult(call.id, "Permission denied by user", isError = true)
            PermissionDecision.ASK -> {
                // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³ Ğ¸ Ğ¶Ğ´Ğ°Ñ‚ÑŒ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
                val userDecision = permissionService.requestUserDecision(call)
                if (userDecision.allowed) toolExecutor.execute(call)
                else ToolResult(call.id, "Permission denied by user", isError = true)
            }
        }
    }
}
```

### 3. UI â€” Chat Panel (Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Swing)

```kotlin
// ui/chat/ChatPanel.kt
class ChatPanel(
    private val project: Project,
    private val session: SessionState,
    private val scope: CoroutineScope
) : JBPanel<ChatPanel>(BorderLayout()) {

    private val messageList = MessageListPanel(project)
    private val inputPanel = ChatInputPanel(project, ::onSendMessage)
    private val statusPanel = StatusPanel()
    private val splitter = OnePixelSplitter(true, 0.75f).apply {
        firstComponent = JBScrollPane(messageList).apply {
            border = JBUI.Borders.empty()
            verticalScrollBarPolicy = ScrollPaneConstants.VERTICAL_SCROLLBAR_AS_NEEDED
        }
        secondComponent = inputPanel
    }

    init {
        add(splitter, BorderLayout.CENTER)
        add(statusPanel, BorderLayout.SOUTH)

        // ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ½Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ÑĞµÑÑĞ¸Ğ¸ Ñ‡ĞµÑ€ĞµĞ· StateFlow
        scope.launch {
            session.messages.collect { messages ->
                withContext(Dispatchers.EDT) {
                    messageList.updateMessages(messages)
                }
            }
        }

        scope.launch {
            session.streamingContent.collect { delta ->
                withContext(Dispatchers.EDT) {
                    messageList.appendStreamingDelta(delta)
                }
            }
        }
    }

    private fun onSendMessage(text: String, attachments: List<Attachment>) {
        scope.launch {
            session.sendMessage(text, attachments)
        }
    }
}
```

#### Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹

```kotlin
// ui/chat/MessageBubble.kt
class MessageBubble(
    private val project: Project,
    private val message: Message
) : JBPanel<MessageBubble>(VerticalLayout(JBUI.scale(4))) {

    init {
        border = JBUI.Borders.empty(8, 12)
        background = when (message.role) {
            Role.USER -> JBColor.namedColor("Claude.UserBubble", JBColor(0xE3F2FD, 0x1A3A4A))
            Role.ASSISTANT -> JBColor.namedColor("Claude.AssistantBubble", JBColor(0xFFFFFF, 0x2B2D30))
        }

        message.content.forEach { block ->
            add(renderContentBlock(block))
        }
    }

    private fun renderContentBlock(block: ContentBlock): JComponent = when (block) {
        is ContentBlock.Text -> MarkdownRenderer.render(project, block.text)
        is ContentBlock.Code -> CodeBlockPanel(project, block.code, block.language)
        is ContentBlock.ToolUse -> ToolCallPanel(block.toolName, block.input, block.result)
        is ContentBlock.Thinking -> ThinkingPanel(block.text)
        is ContentBlock.Image -> ImagePanel(block.data)
    }
}
```

#### ĞŸĞ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° ĞºĞ¾Ğ´Ğ° â€” Ñ‡ĞµÑ€ĞµĞ· IntelliJ Editor

```kotlin
// ui/chat/CodeBlockPanel.kt
class CodeBlockPanel(
    private val project: Project,
    private val code: String,
    private val language: String?
) : JBPanel<CodeBlockPanel>(BorderLayout()) {

    init {
        // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ read-only Editor fragment Ñ Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ¾Ğ¹
        val fileType = language?.let { FileTypeManager.getInstance().getFileTypeByExtension(it) }
            ?: PlainTextFileType.INSTANCE
        val document = EditorFactory.getInstance().createDocument(code)
        val editor = EditorFactory.getInstance().createViewer(document, project).apply {
            settings.apply {
                isLineNumbersShown = true
                isFoldingOutlineShown = false
                additionalLinesCount = 0
                additionalColumnsCount = 0
                isCaretRowShown = false
            }
            // ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‚ĞºÑƒ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ñƒ Ñ„Ğ°Ğ¹Ğ»Ğ°
            (this as? EditorEx)?.highlighter =
                EditorHighlighterFactory.getInstance().createEditorHighlighter(project, fileType)
        }

        // Toolbar: Copy, Apply
        val toolbar = JPanel(FlowLayout(FlowLayout.RIGHT, 4, 0)).apply {
            isOpaque = false
            add(ActionButton(CopyCodeAction(code), "Copy"))
            add(ActionButton(ApplyCodeAction(project, code), "Apply"))
        }

        add(toolbar, BorderLayout.NORTH)
        add(editor.component, BorderLayout.CENTER)

        // Dispose editor Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
        Disposer.register(this) { EditorFactory.getInstance().releaseEditor(editor) }
    }
}
```

### 4. Permission Dialog (Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ IntelliJ)

```kotlin
// ui/dialog/PermissionDialog.kt
class PermissionDialog(
    project: Project,
    private val request: PermissionRequest
) : DialogWrapper(project) {

    private var rememberDecision = false

    init {
        title = "Tool Permission Request"
        setOKButtonText("Allow")
        setCancelButtonText("Deny")
        init()
    }

    override fun createCenterPanel(): JComponent = panel {
        row {
            icon(AllIcons.General.QuestionDialog)
            label("${request.toolName} wants to access:").bold()
        }
        row {
            // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒ â€” Ğ¿ÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ, ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ Ğ¸ Ñ‚.Ğ´.
            text(request.description).applyToComponent {
                foreground = JBColor.GRAY
            }
        }
        if (request.filePath != null) {
            row {
                label("File: ${request.filePath}")
            }
        }
        separator()
        row {
            checkBox("Always allow ${request.toolName}")
                .bindSelected(::rememberDecision)
        }
    }

    fun getDecision(): PermissionDecision = when {
        isOK && rememberDecision -> PermissionDecision.ALWAYS_ALLOW
        isOK -> PermissionDecision.ALLOW_ONCE
        else -> PermissionDecision.DENY
    }
}
```

### 5. MCP Client (Ñ‡Ğ¸ÑÑ‚Ñ‹Ğ¹ Kotlin)

```kotlin
// mcp/McpClient.kt
class McpClient(
    private val config: McpServerConfig,
    private val scope: CoroutineScope
) {
    private var transport: McpTransport? = null
    private var requestId = AtomicInteger(0)
    private val pendingRequests = ConcurrentHashMap<Int, CompletableDeferred<JsonObject>>()

    suspend fun connect() {
        transport = when (config.transport) {
            is McpTransportConfig.Stdio -> McpStdioTransport(config.command, config.args, config.env)
            is McpTransportConfig.Sse -> McpSseTransport(config.url)
            is McpTransportConfig.Http -> McpHttpTransport(config.url)
        }
        transport!!.connect()
        // Initialize handshake
        sendRequest("initialize", buildJsonObject {
            put("protocolVersion", "2024-11-05")
            putJsonObject("capabilities") {}
            putJsonObject("clientInfo") {
                put("name", "claude-code-gui")
                put("version", "1.0.0")
            }
        })
        sendNotification("notifications/initialized")
    }

    suspend fun listTools(): List<McpToolDefinition> {
        val response = sendRequest("tools/list", buildJsonObject {})
        return Json.decodeFromJsonElement(response["tools"]!!)
    }

    suspend fun callTool(name: String, arguments: JsonObject): JsonObject {
        return sendRequest("tools/call", buildJsonObject {
            put("name", name)
            put("arguments", arguments)
        })
    }

    private suspend fun sendRequest(method: String, params: JsonObject): JsonObject {
        val id = requestId.incrementAndGet()
        val deferred = CompletableDeferred<JsonObject>()
        pendingRequests[id] = deferred
        transport!!.send(buildJsonObject {
            put("jsonrpc", "2.0")
            put("id", id)
            put("method", method)
            put("params", params)
        })
        return withTimeout(30_000) { deferred.await() }
    }

    suspend fun disconnect() {
        transport?.disconnect()
    }
}
```

### 6. Session Management

```kotlin
// core/session/SessionState.kt
class SessionState(
    val sessionId: String,
    private val storage: SessionStorage,
    private val scope: CoroutineScope
) {
    private val _messages = MutableStateFlow<List<Message>>(emptyList())
    val messages: StateFlow<List<Message>> = _messages.asStateFlow()

    private val _streamingContent = MutableSharedFlow<StreamEvent>(extraBufferCapacity = 64)
    val streamingContent: SharedFlow<StreamEvent> = _streamingContent.asSharedFlow()

    private val _status = MutableStateFlow(SessionStatus.IDLE)
    val status: StateFlow<SessionStatus> = _status.asStateFlow()

    private var currentJob: Job? = null

    suspend fun sendMessage(text: String, attachments: List<Attachment>) {
        val userMessage = Message.user(text, attachments)
        _messages.update { it + userMessage }
        _status.value = SessionStatus.STREAMING

        currentJob = scope.launch {
            try {
                agenticLoop.run(
                    conversation = Conversation(sessionId, _messages.value),
                    config = providerConfig,
                    onEvent = { event ->
                        _streamingContent.emit(event)
                        when (event) {
                            is StreamEvent.StreamEnd -> {
                                // Ğ¤Ğ¸Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ°
                                _messages.update { it + currentAssistantMessage }
                            }
                            else -> {}
                        }
                    }
                ).collect { agentEvent ->
                    // Handle agentic events (tool calls, etc.)
                }
            } catch (e: CancellationException) {
                throw e
            } catch (e: Exception) {
                _status.value = SessionStatus.ERROR(e.message ?: "Unknown error")
            } finally {
                _status.value = SessionStatus.IDLE
                // Persist to disk
                storage.save(sessionId, _messages.value)
            }
        }
    }

    fun cancel() {
        currentJob?.cancel()
    }

    fun rewindTo(messageIndex: Int) {
        _messages.update { it.take(messageIndex + 1) }
        scope.launch { storage.save(sessionId, _messages.value) }
    }
}
```

### 7. Settings (PersistentStateComponent)

```kotlin
// service/SettingsService.kt
@Service(Service.Level.APP)
@State(
    name = "ClaudeCodeGuiSettings",
    storages = [Storage("claudeCodeGui.xml")]
)
class SettingsService : PersistentStateComponent<SettingsService.State> {

    data class State(
        var claudeApiKey: String = "",
        var claudeBaseUrl: String = "https://api.anthropic.com",
        var claudeModel: String = "claude-sonnet-4-20250514",
        var codexApiKey: String = "",
        var codexBaseUrl: String = "https://api.openai.com",
        var codexModel: String = "gpt-4o",
        var activeProvider: String = "claude",
        var language: String = "en",
        var fontScale: Float = 1.0f,
        var mcpServers: MutableList<McpServerConfig> = mutableListOf(),
        var permissionRules: MutableList<PermissionRule> = mutableListOf(),
        var systemPrompt: String = "",
        var maxTokens: Int = 8192
    )

    private var state = State()

    override fun getState(): State = state
    override fun loadState(state: State) { this.state = state }
}
```

### 8. Markdown Renderer

```kotlin
// ui/common/MarkdownRenderer.kt
object MarkdownRenderer {

    /**
     * Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ñ‚ Markdown Ğ² Ğ´ĞµÑ€ĞµĞ²Ğ¾ Swing-ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ².
     * Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ commonmark-java Ğ´Ğ»Ñ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ° Ğ¸ ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğ¹ visitor Ğ´Ğ»Ñ Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³Ğ°.
     *
     * - Ğ¢ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸ â†’ JBLabel Ñ HTML
     * - ĞšĞ¾Ğ´ Ñ Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ¾Ğ¹ â†’ CodeBlockPanel (IntelliJ Editor)
     * - Ğ¡Ğ¿Ğ¸ÑĞºĞ¸ â†’ Ğ²ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ Ñ Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ°Ğ¼Ğ¸
     * - Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ â†’ JBTable
     * - Ğ¡ÑÑ‹Ğ»ĞºĞ¸ â†’ ĞºĞ»Ğ¸ĞºĞ°Ğ±ĞµĞ»ÑŒĞ½Ñ‹Ğµ HyperlinkLabel
     */
    fun render(project: Project, markdown: String): JComponent {
        val parser = Parser.builder().build()
        val document = parser.parse(markdown)
        val visitor = SwingNodeVisitor(project)
        document.accept(visitor)
        return visitor.result
    }
}

// Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğ¹ visitor Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·ÑƒĞµÑ‚ AST â†’ Swing-ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
class SwingNodeVisitor(private val project: Project) : AbstractVisitor() {
    val result = JBPanel<JBPanel<*>>(VerticalLayout(4))

    override fun visit(fencedCodeBlock: FencedCodeBlock) {
        val lang = fencedCodeBlock.info?.toString()?.trim()
        val code = fencedCodeBlock.literal.trimEnd()
        result.add(CodeBlockPanel(project, code, lang))
    }

    override fun visit(paragraph: Paragraph) {
        val html = HtmlRenderer.builder().build().render(paragraph)
        result.add(JBLabel("<html>$html</html>"))
    }

    // ... Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ visit-Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ², Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†, ÑÑÑ‹Ğ»Ğ¾Ğº Ğ¸ Ñ‚.Ğ´.
}
```

### 9. Tool Window Factory

```kotlin
// ui/toolwindow/ClaudeToolWindowFactory.kt
class ClaudeToolWindowFactory : ToolWindowFactory {

    override fun createToolWindowContent(project: Project, toolWindow: ToolWindow) {
        val scope = CoroutineScope(SupervisorJob() + Dispatchers.Default)
        Disposer.register(toolWindow.disposable) { scope.cancel() }

        val contentFactory = ContentFactory.getInstance()
        val sessionManager = project.service<SessionManager>()

        // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿ĞµÑ€Ğ²ÑƒÑ Ğ²ĞºĞ»Ğ°Ğ´ĞºÑƒ
        val session = sessionManager.createSession()
        val chatPanel = ChatPanel(project, session, scope)
        val content = contentFactory.createContent(chatPanel, "Chat 1", false).apply {
            isCloseable = true
            setDisposer(chatPanel)
        }
        toolWindow.contentManager.addContent(content)

        // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ "+" Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ²ĞºĞ»Ğ°Ğ´Ğ¾Ğº
        toolWindow.setTitleActions(listOf(
            object : AnAction("New Chat", "Create new chat tab", AllIcons.General.Add) {
                override fun actionPerformed(e: AnActionEvent) {
                    val newSession = sessionManager.createSession()
                    val newPanel = ChatPanel(project, newSession, scope)
                    val newContent = contentFactory.createContent(
                        newPanel,
                        "Chat ${toolWindow.contentManager.contentCount + 1}",
                        false
                    ).apply { isCloseable = true }
                    toolWindow.contentManager.addContent(newContent)
                    toolWindow.contentManager.setSelectedContent(newContent)
                }
            }
        ))
    }
}
```

### 10. Coroutine Architecture

```kotlin
// util/CoroutineScopes.kt
object PluginCoroutineScope {
    /**
     * Application-level scope â€” Ğ¶Ğ¸Ğ²Ñ‘Ñ‚ Ğ¿Ğ¾ĞºĞ° Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½.
     * Ğ”Ğ»Ñ Ğ´Ğ¾Ğ»Ğ³Ğ¾Ğ¶Ğ¸Ğ²ÑƒÑ‰Ğ¸Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² (MCP, settings watcher).
     */
    val applicationScope = CoroutineScope(
        SupervisorJob() + Dispatchers.Default + CoroutineName("ClaudeCodeGui")
    )

    /**
     * IO scope â€” Ğ´Ğ»Ñ ÑĞµÑ‚ĞµĞ²Ñ‹Ñ… Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ², Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ñ‹Ñ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹.
     */
    val ioScope = CoroutineScope(
        SupervisorJob() + Dispatchers.IO + CoroutineName("ClaudeCodeGui-IO")
    )
}

// Ğ’ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ Project-level service:
@Service(Service.Level.PROJECT)
class ConversationService(private val project: Project) : Disposable {
    private val scope = CoroutineScope(SupervisorJob() + Dispatchers.Default)

    override fun dispose() {
        scope.cancel()
    }
}
```

---

## Plugin.xml

```xml
<idea-plugin>
    <id>com.github.claudecodegui</id>
    <name>Claude Code GUI</name>
    <vendor>claudecodegui</vendor>
    <depends>com.intellij.modules.platform</depends>
    <depends optional="true" config-file="java-features.xml">com.intellij.java</depends>
    <depends optional="true" config-file="python-features.xml">com.intellij.modules.python</depends>
    <depends optional="true" config-file="terminal-features.xml">org.jetbrains.plugins.terminal</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Tool Window -->
        <toolWindow id="Claude Code" anchor="right" icon="/icons/claude.svg"
                    factoryClass="com.github.claudecodegui.ui.toolwindow.ClaudeToolWindowFactory"/>

        <!-- Settings -->
        <applicationConfigurable instance="com.github.claudecodegui.ui.settings.ClaudeSettingsConfigurable"
                                 displayName="Claude Code GUI" id="claude.code.gui.settings"/>

        <!-- Services -->
        <applicationService serviceImplementation="com.github.claudecodegui.service.SettingsService"/>
        <projectService serviceImplementation="com.github.claudecodegui.service.ConversationService"/>
        <projectService serviceImplementation="com.github.claudecodegui.service.ProviderService"/>
        <projectService serviceImplementation="com.github.claudecodegui.core.session.SessionManager"/>
        <projectService serviceImplementation="com.github.claudecodegui.tool.permission.PermissionService"/>
        <projectService serviceImplementation="com.github.claudecodegui.mcp.McpServerManager"/>

        <!-- Startup -->
        <postStartupActivity implementation="com.github.claudecodegui.plugin.StartupActivity"/>

        <!-- Status Bar -->
        <statusBarWidgetFactory id="ClaudeCodeStatus"
                                implementation="com.github.claudecodegui.ui.status.ClaudeStatusBarWidgetFactory"/>

        <!-- Notifications -->
        <notificationGroup id="Claude Code" displayType="BALLOON"/>
    </extensions>

    <actions>
        <action id="Claude.SendSelection" class="com.github.claudecodegui.action.SendSelectionAction"
                text="Send to Claude" description="Send selected code to Claude"
                icon="/icons/claude.svg">
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl alt K"/>
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
        </action>

        <action id="Claude.QuickFix" class="com.github.claudecodegui.action.QuickFixAction"
                text="Quick Fix with Claude" description="Fix code with Claude AI">
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift Q"/>
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
        </action>

        <action id="Claude.SendFilePath" class="com.github.claudecodegui.action.SendFilePathAction"
                text="Send File Path to Claude">
            <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
        </action>

        <action id="Claude.GenerateCommit" class="com.github.claudecodegui.action.GenerateCommitAction"
                text="Generate Commit Message" description="Generate commit message with AI"
                icon="/icons/claude.svg">
            <add-to-group group-id="Vcs.MessageActionGroup" anchor="first"/>
        </action>
    </actions>
</idea-plugin>
```

---

## Gradle Build (Kotlin DSL)

```kotlin
// build.gradle.kts
plugins {
    id("java")
    id("org.jetbrains.kotlin.jvm") version "2.1.0"
    id("org.jetbrains.kotlin.plugin.serialization") version "2.1.0"
    id("org.jetbrains.intellij.platform") version "2.3.0"
}

group = "com.github.claudecodegui"
version = "1.0.0"

kotlin {
    jvmToolchain(17)
}

repositories {
    mavenCentral()
    intellijPlatform { defaultRepositories() }
}

dependencies {
    intellijPlatform {
        intellijIdeaCommunity("2024.3.1")
        bundledPlugin("com.intellij.java")
        bundledPlugin("org.jetbrains.plugins.terminal")
        instrumentationTools()
    }

    // Kotlin Coroutines
    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-core:1.9.0")
    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-swing:1.9.0") // Dispatchers.EDT

    // Serialization
    implementation("org.jetbrains.kotlinx:kotlinx-serialization-json:1.7.3")

    // HTTP Client (Ktor)
    implementation("io.ktor:ktor-client-core:3.1.0")
    implementation("io.ktor:ktor-client-cio:3.1.0")
    implementation("io.ktor:ktor-client-content-negotiation:3.1.0")
    implementation("io.ktor:ktor-serialization-kotlinx-json:3.1.0")
    implementation("io.ktor:ktor-client-logging:3.1.0")

    // Markdown parsing
    implementation("org.commonmark:commonmark:0.24.0")
    implementation("org.commonmark:commonmark-ext-gfm-tables:0.24.0")
    implementation("org.commonmark:commonmark-ext-gfm-strikethrough:0.24.0")
    implementation("org.commonmark:commonmark-ext-autolink:0.24.0")

    // Testing
    testImplementation("org.jetbrains.kotlin:kotlin-test")
    testImplementation("org.jetbrains.kotlinx:kotlinx-coroutines-test:1.9.0")
    testImplementation("io.mockk:mockk:1.13.13")
}

intellijPlatform {
    pluginConfiguration {
        ideaVersion {
            sinceBuild = "233"
            untilBuild = "263.*"
        }
    }
}
```

---

## ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ (Java+JCEF+Node) | Ğ¦ĞµĞ»ĞµĞ²Ğ°Ñ (Kotlin native) |
|---------|--------------------------|------------------------|
| RAM Ğ½Ğ° Ğ²ĞºĞ»Ğ°Ğ´ĞºÑƒ | ~150â€“300 MB (Chromium) | ~5â€“15 MB (Swing panels) |
| Ğ¥Ğ¾Ğ»Ğ¾Ğ´Ğ½Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚ | 3â€“5 ÑĞµĞº (JCEF + bridge extract) | <0.5 ÑĞµĞº |
| Ğ’Ñ€ĞµĞ¼Ñ Ğ´Ğ¾ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ | ~2 ÑĞµĞº (Node spawn) | <100 Ğ¼Ñ (Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ HTTP) |
| ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ² | 3 (JVM + Chromium + Node) | 1 (JVM) |
| Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° | ~15 MB (ai-bridge.zip + webview) | ~3â€“5 MB |
| Ğ¡Ğ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ñ Remote Dev | ĞĞµÑ‚ (JCEF Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚) | Ğ”Ğ° (Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ UI) |

---

## Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ (Feature Parity)

ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ **Ğ²ÑĞµ** Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸:

### ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ (P0)
1. ĞœĞ½Ğ¾Ğ³Ğ¾Ğ²ĞºĞ»Ğ°Ğ´Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚ Ñ Claude Ğ¸ Codex
2. Ğ¡Ñ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ñ Markdown-Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³Ğ¾Ğ¼
3. ĞŸĞ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸ÑĞ° Ğ² code blocks Ñ‡ĞµÑ€ĞµĞ· IntelliJ Editor
4. Agentic loop: tool_use â†’ execute â†’ tool_result â†’ continue
5. Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹: Read, Write, Edit, Bash, Glob, Grep, WebFetch, SubAgent
6. Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹: ask/allow/deny Ñ Ğ·Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸ĞµĞ¼
7. MCP-ÑĞµÑ€Ğ²ĞµÑ€ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ (stdio, SSE, HTTP Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ñ‹)
8. Inline diff preview + apply/discard Ñ‡ĞµÑ€ĞµĞ· IntelliJ DiffManager
9. Ctrl+Alt+K â€” Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ²Ñ‹Ğ´ĞµĞ»ĞµĞ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´ Ğ² Ñ‡Ğ°Ñ‚
10. Ctrl+Shift+Q â€” Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ñ„Ğ¸ĞºÑ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
11. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ commit-ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
12. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ/Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ ÑĞµÑÑĞ¸Ğ¹ (JSONL)
13. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸: API keys, Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸, base URL, system prompt
14. Slash-ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ (/init, /review, /commit, Ğ¸ Ñ‚.Ğ´.)
15. Plan approval dialog (Ğ°Ğ³ĞµĞ½Ñ‚ Ğ¿Ñ€ĞµĞ´Ğ»Ğ°Ğ³Ğ°ĞµÑ‚ Ğ¿Ğ»Ğ°Ğ½ â†’ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ğ´Ğ¾Ğ±Ñ€ÑĞµÑ‚)
16. Rewind conversation (Ğ¾Ñ‚ĞºĞ°Ñ‚ Ğº Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¼Ñƒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ)

### Ğ’Ğ°Ğ¶Ğ½Ñ‹Ğµ (P1)
17. @file-ÑÑÑ‹Ğ»ĞºĞ¸ â€” Ğ¿Ğ¾Ğ´ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ² ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚
18. Ğ’Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ (Ñ„Ğ°Ğ¹Ğ»Ñ‹, Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ)
19. ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ¸Ğ· IDE â€” Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ», Ğ²Ñ‹Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ, Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ ĞºĞ¾Ğ¼Ğ¿Ğ¸Ğ»ÑÑ†Ğ¸Ğ¸
20. Token counter (Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²)
21. Thinking/reasoning Ğ±Ğ»Ğ¾ĞºĞ¸ (ÑĞ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ)
22. Status bar widget (Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸)
23. Ğ¢Ñ‘Ğ¼Ğ½Ğ°Ñ/ÑĞ²ĞµÑ‚Ğ»Ğ°Ñ Ñ‚ĞµĞ¼Ğ° â€” Ğ°Ğ²Ñ‚Ğ¾ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ IDE
24. Session favorites (Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞµÑÑĞ¸Ğ¸)
25. Export transcripts
26. ĞœĞ½Ğ¾Ğ³Ğ¾ÑĞ·Ñ‹Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ (i18n): en, ru, zh, ja, fr, hi, es, zh-TW

### Ğ–ĞµĞ»Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ (P2)
27. Mermaid-Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ (PlantUML ĞºĞ°Ğº Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ°)
28. Terminal output monitoring
29. Java/Python PSI context collection
30. Interactive diff editing (Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾Ñ‡Ğ½Ğ¾Ğµ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿ĞµÑ€ĞµĞ´ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸ĞµĞ¼)

---

## ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ¸ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ

1. **100% Kotlin** â€” Ğ½Ğ¸ĞºĞ°ĞºĞ¾Ğ³Ğ¾ Java-ĞºĞ¾Ğ´Ğ°.
2. **ĞĞ¸ĞºĞ°ĞºĞ¾Ğ³Ğ¾ JCEF/webview** â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Swing/IntelliJ UI.
3. **ĞĞ¸ĞºĞ°ĞºĞ¾Ğ³Ğ¾ Node.js** â€” Ğ¿Ñ€ÑĞ¼Ñ‹Ğµ HTTP-Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹ Ğ¸Ğ· JVM.
4. **Kotlin Coroutines** Ğ´Ğ»Ñ Ğ²ÑĞµĞ¹ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾ÑÑ‚Ğ¸ â€” Ğ½Ğ¸ĞºĞ°ĞºĞ¸Ñ… `Thread`, `ExecutorService`, callback hell.
5. **`kotlinx.serialization`** Ğ´Ğ»Ñ JSON â€” Ğ½Ğ¸ĞºĞ°ĞºĞ¾Ğ³Ğ¾ Gson/Jackson.
6. **IntelliJ UI DSL 2.0** (`panel { row { ... } }`) Ğ´Ğ»Ñ Ñ„Ğ¾Ñ€Ğ¼ Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº.
7. **`StateFlow`/`SharedFlow`** Ğ´Ğ»Ñ Ñ€ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ UI â€” Ğ½Ğ¸ĞºĞ°ĞºĞ¸Ñ… ÑĞ°Ğ¼Ğ¾Ğ¿Ğ¸ÑĞ½Ñ‹Ñ… event bus.
8. **IntelliJ Editor API** Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ¸ ĞºĞ¾Ğ´Ğ° â€” Ğ½Ğµ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğ½Ğ¸Ğ¹ JS-highlighter.
9. **IntelliJ DiffManager** Ğ´Ğ»Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ â€” Ğ½Ğµ ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğ¹ diff viewer.
10. **Structured concurrency**: ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ scope Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ½ Ğº Disposable.
11. **ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸**: Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ktor, kotlinx.serialization, commonmark.
12. **Thread safety**: EDT Ğ´Ğ»Ñ UI, IO dispatcher Ğ´Ğ»Ñ ÑĞµÑ‚Ğ¸, Default Ğ´Ğ»Ñ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğ¹.
13. Ğ’ÑĞµ API-ĞºĞ»ÑÑ‡Ğ¸ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· `PasswordSafe` (IntelliJ Credential Store).
14. Ğ’ÑĞµ Ğ´Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ â€” Ñ `ProgressIndicator`.
15. ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° IntelliJ 2023.3+ (build 233+) Ğ´Ğ¾ 2026.3+ (build 263+).

---

## ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğ¹)

### Ğ¤Ğ°Ğ·Ğ° 1: Ğ¯Ğ´Ñ€Ğ¾ (1-2 Ğ½ĞµĞ´ĞµĞ»Ğ¸)
- [ ] Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°, Gradle, plugin.xml
- [ ] Domain models (Message, Conversation, ContentBlock)
- [ ] SettingsService (PersistentStateComponent)
- [ ] ClaudeProvider â€” Ğ¿Ñ€ÑĞ¼Ñ‹Ğµ HTTP-Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹ Ñ SSE-ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ¾Ğ¼
- [ ] Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ToolWindow Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ²ĞºĞ»Ğ°Ğ´ĞºĞ¾Ğ¹ Ñ‡Ğ°Ñ‚Ğ°
- [ ] ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹ MessageList + ChatInput
- [ ] ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ°/Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹, ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ Ğ² UI

### Ğ¤Ğ°Ğ·Ğ° 2: Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¸ Ğ°Ğ³ĞµĞ½Ñ‚ (1-2 Ğ½ĞµĞ´ĞµĞ»Ğ¸)
- [ ] ToolRegistry + Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ (Read, Write, Edit, Bash)
- [ ] AgenticLoop (tool_use â†’ execute â†’ tool_result)
- [ ] PermissionService + PermissionDialog
- [ ] Inline diff preview

### Ğ¤Ğ°Ğ·Ğ° 3: UI Polish (1 Ğ½ĞµĞ´ĞµĞ»Ñ)
- [ ] Markdown renderer (commonmark â†’ Swing)
- [ ] CodeBlockPanel Ñ IntelliJ Editor Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ¾Ğ¹
- [ ] ThinkingPanel (ÑĞ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¹)
- [ ] StreamingIndicator
- [ ] Multi-tab support
- [ ] Session persistence (JSONL)

### Ğ¤Ğ°Ğ·Ğ° 4: Advanced Features (1-2 Ğ½ĞµĞ´ĞµĞ»Ğ¸)
- [ ] MCP Client (Ğ²ÑĞµ 3 Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ°)
- [ ] Slash-ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹
- [ ] Plan approval dialog
- [ ] Rewind conversation
- [ ] @file references + attachments
- [ ] IDE context collection (active file, selection)
- [ ] Quick Fix action
- [ ] Commit message generation

### Ğ¤Ğ°Ğ·Ğ° 5: Polishing (1 Ğ½ĞµĞ´ĞµĞ»Ñ)
- [ ] CodexProvider (OpenAI)
- [ ] i18n (Ğ²ÑĞµ 8 ÑĞ·Ñ‹ĞºĞ¾Ğ²)
- [ ] Settings UI (IntelliJ DSL)
- [ ] Token counter
- [ ] Status bar widget
- [ ] History panel + favorites
- [ ] Theme sync
- [ ] Export transcripts
- [ ] PasswordSafe Ğ´Ğ»Ñ API ĞºĞ»ÑÑ‡ĞµĞ¹

---

## Ğ ĞµĞ·ÑĞ¼Ğµ

Ğ­Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚ Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ **Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ IntelliJ-Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° Ğ½Ğ° Kotlin**, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ·Ğ°Ğ¼ĞµĞ½ÑĞµÑ‚ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñƒ Java + JCEF + React + Node.js. ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ñ‹ÑˆĞ¸:

- **Ğ’ 10-20x Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ğµ RAM** (Ğ½ĞµÑ‚ Chromium)
- **ĞœĞ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚** (Ğ½ĞµÑ‚ Ñ€Ğ°ÑĞ¿Ğ°ĞºĞ¾Ğ²ĞºĞ¸ bridge, Ğ½ĞµÑ‚ ÑĞ¿Ğ°Ğ²Ğ½Ğ° Node)
- **ĞĞ´Ğ¸Ğ½ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ** (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ JVM)
- **ĞĞ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ UX** (Ñ‚ĞµĞ¼Ğ° IDE, ÑˆÑ€Ğ¸Ñ„Ñ‚Ñ‹, accessibility Ğ¸Ğ· ĞºĞ¾Ñ€Ğ¾Ğ±ĞºĞ¸)
- **ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Remote Development** (Swing Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ² thin client)
- **ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ğ° Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸** (Ğ¾Ğ´Ğ¸Ğ½ ÑÑ‚ĞµĞº, Ğ¾Ğ´Ğ¸Ğ½ ÑĞ·Ñ‹Ğº, Ğ¾Ğ´Ğ½Ğ° IDE)
- **ĞœĞµĞ½ÑŒÑˆĞµ ĞºĞ¾Ğ´Ğ°** (Kotlin DSL, coroutines, sealed classes Ğ²Ğ¼ĞµÑÑ‚Ğ¾ JS+Java+Node)

## Ğ ĞµÑ„ĞµÑ€ĞµĞ½ÑĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
/Users/dsudomoin/IdeaProjects/idea-claude-code-gui

---

## Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ (Feature Parity Tracker)

Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Kotlin-Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ñ Ñ€ĞµÑ„ĞµÑ€ĞµĞ½ÑĞ½Ñ‹Ğ¼ Java+JCEF+React Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ¼.

### Ğ£ÑĞ»Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¾Ğ±Ğ¾Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ
- âœ… â€” Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾
- ğŸ”§ â€” Ğ§Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾
- âŒ â€” ĞĞµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾
- ğŸ”œ â€” Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸

---

### Tier 0: Ğ¯Ğ´Ñ€Ğ¾ (Core) â€” ÑƒĞ¶Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚

| # | Ğ¤Ğ¸Ñ‡Ğ° | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ | ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ |
|---|-------|--------|------------|
| 1 | Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°, Gradle, plugin.xml | âœ… | Kotlin 2.1.20, IntelliJ 2025.2 |
| 2 | Domain models (Message, ContentBlock, Conversation, StreamEvent) | âœ… | `@Serializable`, sealed classes |
| 3 | SettingsService (PersistentStateComponent) | âœ… | baseUrl, model, maxTokens, systemPrompt, nodePath Ğ¸ Ñ‚.Ğ´. |
| 4 | ClaudeProvider Ñ‡ĞµÑ€ĞµĞ· Node.js bridge + SDK | âœ… | claude-bridge.mjs, stdin/stdout IPC |
| 5 | Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ToolWindow Ñ Ğ²ĞºĞ»Ğ°Ğ´ĞºĞ°Ğ¼Ğ¸ | âœ… | ChatPanel + "New Chat" ĞºĞ½Ğ¾Ğ¿ĞºĞ° |
| 6 | MessageListPanel + ChatInputPanel | âœ… | ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğ¹ rounded input Ñ Ñ‚ÑƒĞ»Ğ±Ğ°Ñ€Ğ¾Ğ¼ |
| 7 | Ğ¡Ñ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ | âœ… | TextDelta, ThinkingDelta, Snapshot |
| 8 | Markdown Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ (commonmark â†’ Swing) | âœ… | Headings, code blocks, lists, tables, quotes |
| 9 | ĞŸĞ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° ĞºĞ¾Ğ´Ğ° Ñ‡ĞµÑ€ĞµĞ· IntelliJ Editor | âœ… | EditorFactory + EditorHighlighter |
| 10 | ThinkingPanel (ÑĞ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¹) | âœ… | Expand/collapse, gold theme |
| 11 | ToolUseBlock (ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²) | âœ… | Pending/Complete/Error, diff, bash, Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ñ |
| 12 | Permission dialog (Allow/Deny) | âœ… | DialogWrapper Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑĞ¼Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ° |
| 13 | OAuth Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ | âœ… | Keychain + file fallback, token refresh |
| 14 | Node.js auto-detection | âœ… | Homebrew, nvm, fnm, Volta, system |
| 15 | Ğ¡ĞµĞ»ĞµĞºÑ‚Ğ¾Ñ€ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ (popup) | âœ… | Sonnet 4.6, Opus 4.6, Haiku 4.5, Opus 1M |
| 16 | Ğ¡ĞµĞ»ĞµĞºÑ‚Ğ¾Ñ€ permission mode (popup) | âœ… | Default, Plan, YOLO |
| 17 | Toggle streaming / thinking | âœ… | Ğ¨ĞµÑÑ‚ĞµÑ€Ñ‘Ğ½ĞºĞ° â†’ popup Ñ iOS-style toggles |
| 18 | Token usage display | âœ… | Status bar: in/out/cache |
| 19 | Ctrl+Alt+K â€” Send Selection to Chat | âœ… | ĞšĞ¾Ğ´ + Ñ„Ğ°Ğ¹Ğ» + ÑĞ·Ñ‹Ğº |
| 20 | Ğ’Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ¾Ğ² (picker + paste + DnD) | âœ… | Thumbnail chips, click-to-open, Cmd+V |
| 21 | File context chip (Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ñ„Ğ°Ğ¹Ğ» + ÑÑ‚Ñ€Ğ¾ĞºĞ¸) | âœ… | FileEditorManagerListener + CaretListener |
| 22 | Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ² ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ÑÑ… Ñ‡Ğ°Ñ‚Ğ° | âœ… | ContentBlock.Image, thumbnail 280x200 |
| 23 | Multi-tab Ñ‡Ğ°Ñ‚ | âœ… | ĞĞ¾Ğ²Ñ‹Ğµ Ğ²ĞºĞ»Ğ°Ğ´ĞºĞ¸ Ñ‡ĞµÑ€ĞµĞ· "+" ĞºĞ½Ğ¾Ğ¿ĞºÑƒ |
| 24 | Dark/Light theme sync | âœ… | JBColor.namedColor, Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ |

---

### Tier 1: Ğ’Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰Ğ¸Ğµ Ñ„Ğ¸Ñ‡Ğ¸ â€” Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚

| # | Ğ¤Ğ¸Ñ‡Ğ° | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|---|-------|--------|----------|
| 25 | Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑĞµÑÑĞ¸Ğ¹ (save/load) | âœ… | JSONL persistence, SessionStorage, SessionManager |
| 26 | ĞŸĞ°Ğ½ĞµĞ»ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ (sidebar/view) | âœ… | HistoryPanel Ñ CardLayout, Back/Refresh, double-click load |
| 27 | Session resume (Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½Ğ¸Ğµ ÑĞµÑÑĞ¸Ğ¸) | âœ… | loadSession() Ğ² ChatPanel, Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ° |
| 28 | Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ commit message | âœ… | GenerateCommitAction Ğ² Vcs.MessageActionGroup, Ñ‡ĞµÑ€ĞµĞ· ClaudeProvider SDK |
| 29 | Quick Fix with Claude (Ctrl+Shift+Q) | âŒ | Popup Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ñ„Ğ¸ĞºÑĞ° Ğ²Ñ‹Ğ´ĞµĞ»ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ´Ğ°. Ref: `QuickFixWithClaudeAction` |
| 30 | Send File Path (right-click Ğ² Project View) | âŒ | Action Ğ² ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ½Ğ¾Ğ¼ Ğ¼ĞµĞ½Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°. Ref: `SendFilePathToInputAction` |
| 31 | Input history (â†‘/â†“ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ) | âŒ | Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹, Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ ĞºĞ»Ğ°Ğ²Ğ¸ÑˆĞ°Ğ¼Ğ¸. Ref: `input-history-service.cjs` |
| 32 | Copy code button Ğ² code blocks | ğŸ”§ | Ğ•ÑÑ‚ÑŒ ĞºĞ½Ğ¾Ğ¿ĞºĞ° Copy, Ğ½Ğ¾ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑƒĞ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ UX |
| 33 | Undo file changes | âŒ | ĞÑ‚ĞºĞ°Ñ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ², ÑĞ´ĞµĞ»Ğ°Ğ½Ğ½Ñ‹Ñ… AI. Ref: `UndoFileHandler`, `StatusPanel` |

---

### Tier 2: ĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ñ‹Ğµ Ñ„Ğ¸Ñ‡Ğ¸ â€” Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚

| # | Ğ¤Ğ¸Ñ‡Ğ° | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|---|-------|--------|----------|
| 34 | Interactive diff (Apply/Reject) | âœ… | InteractiveDiffManager + Show Diff/Reject ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ² ToolUseBlock |
| 35 | StatusPanel (file changes, todos, subagents) | âœ… | StatusPanel Ñ 3 Ğ²ĞºĞ»Ğ°Ğ´ĞºĞ°Ğ¼Ğ¸ + trackToolUseForStatus/trackToolResultForStatus Ğ² ChatPanel |
| 36 | Plan approval dialog | âŒ | ĞšĞ¾Ğ³Ğ´Ğ° Claude Ğ² plan mode â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ»Ğ°Ğ½ Ğ´Ğ»Ñ Ğ¾Ğ´Ğ¾Ğ±Ñ€ĞµĞ½Ğ¸Ñ. Ref: `PlanApprovalDialog` |
| 37 | AskUserQuestion dialog | âŒ | Claude Ğ·Ğ°Ğ´Ğ°Ñ‘Ñ‚ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ñ‡ĞµÑ€ĞµĞ· UI. Ref: `AskUserQuestionDialog` |
| 38 | Rewind conversation | âŒ | ĞÑ‚ĞºĞ°Ñ‚ Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ° Ğº Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¼Ñƒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ + Ñ„Ğ°Ğ¹Ğ»Ñ‹. Ref: `RewindHandler`, `RewindSelectDialog` |
| 39 | Status bar widget | âŒ | Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ² ÑÑ‚Ğ°Ñ‚ÑƒÑĞ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞµ IDE. Ref: `ClaudeStatusBarWidget` |
| 40 | Grouped tool blocks | âœ… | ToolGroupBlock + streaming/history grouping Ğ² MessageBubble |
| 41 | Export session (MD/JSON) | âŒ | Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ñ‡Ğ°Ñ‚Ğ° Ğ² Ñ„Ğ°Ğ¹Ğ». Ref: `FileExportHandler` |
| 42 | Permission "Always Allow" | âŒ | Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ°. Ref: `PermissionService` Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°Ğ¼Ğ¸ |
| 43 | Auto-deny dangerous paths | âŒ | ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¾Ñ‚ĞºĞ°Ğ· Ğ´Ğ»Ñ /etc, ~/.ssh Ğ¸ Ñ‚.Ğ´. Ref: `PermissionHandler` |

---

### Tier 3: ĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ñ‹Ğµ Ñ„Ğ¸Ñ‡Ğ¸ â€” ĞĞ¸Ğ¶Ğµ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚

| # | Ğ¤Ğ¸Ñ‡Ğ° | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|---|-------|--------|----------|
| 44 | Agent system (Ğ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ°Ğ³ĞµĞ½Ñ‚Ñ‹) | âŒ | ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğµ Ğ°Ğ³ĞµĞ½Ñ‚Ñ‹ Ñ system prompt. Ref: `AgentHandler`, `AgentDialog` |
| 45 | Skills / Slash commands | âŒ | Markdown-ÑĞºĞ¸Ğ»Ğ»Ñ‹ Ğ¸Ğ· ~/.claude/commands/. Ref: `SkillHandler`, `SkillService` |
| 46 | @file references + autocomplete | âŒ | Ğ¡ÑÑ‹Ğ»ĞºĞ¸ Ğ½Ğ° Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ² input Ñ Ğ°Ğ²Ñ‚Ğ¾ĞºĞ¾Ğ¼Ğ¿Ğ»Ğ¸Ñ‚Ğ¾Ğ¼. Ref: `FileReferencePopup`, `Dropdown` |
| 47 | Prompt enhancer | âŒ | AI ÑƒĞ»ÑƒÑ‡ÑˆĞ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ. Ref: `PromptEnhancerHandler` |
| 48 | MCP client (stdio/SSE/HTTP) | âŒ | Model Context Protocol Ğ´Ğ»Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ñ… Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ². Ref: `McpClient`, `mcp-status/` |
| 49 | Terminal monitoring | âŒ | ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ° Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ»Ğ° IDE. Ref: `TerminalMonitorService` |
| 50 | Run/Debug output monitoring | âŒ | ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Run/Debug ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¹. Ref: `RunConfigMonitorService` |
| 51 | Codex provider (OpenAI) | âŒ | Ğ’Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ AI-Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€. Ref: `CodexProvider`, `codex-channel.js` |
| 52 | Multiple provider configs | âŒ | CRUD Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ¾Ğ², Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ¸Ğ· cc-switch. Ref: `ProviderHandler` |
| 53 | Message anchor rail | âŒ | Ğ‘Ğ¾ĞºĞ¾Ğ²Ğ°Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ÑĞ¼. Ref: `MessageAnchorRail` |
| 54 | Message queue | âŒ | ĞÑ‡ĞµÑ€ĞµĞ´ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸. Ref: `MessageQueue.tsx` |

---

### Tier 4: Polish & Extras â€” ĞĞ¸Ğ·ĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚

| # | Ğ¤Ğ¸Ñ‡Ğ° | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|---|-------|--------|----------|
| 55 | i18n (Ğ¼Ğ½Ğ¾Ğ³Ğ¾ÑĞ·Ñ‹Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ) | âŒ | en, ru, zh, ja Ğ¸ Ñ‚.Ğ´. Ref: `react-i18next` |
| 56 | MCP Settings UI | âŒ | Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ MCP ÑĞµÑ€Ğ²ĞµÑ€Ğ°Ğ¼Ğ¸ Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ…. Ref: `McpSettingsSection` |
| 57 | Font scale / custom chat colors | âŒ | ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ° ÑˆÑ€Ğ¸Ñ„Ñ‚Ğ° Ğ¸ Ñ†Ğ²ĞµÑ‚Ğ¾Ğ². Ref: `ThemeConfigService` |
| 58 | Tab rename | âŒ | ĞŸĞµÑ€ĞµĞ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ĞºĞ»Ğ°Ğ´Ğ¾Ğº Ñ‡Ğ°Ñ‚Ğ°. Ref: `RenameTabAction` |
| 59 | BridgePreloader (startup) | âŒ | ĞŸÑ€ĞµĞ´Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° bridge Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ IDE. Ref: `BridgePreloader` |
| 60 | PasswordSafe Ğ´Ğ»Ñ API ĞºĞ»ÑÑ‡ĞµĞ¹ | âŒ | Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ² IntelliJ Credential Store |
| 61 | Token percentage ring indicator | âŒ | Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ğ° Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ². Ref: `TokenIndicator` |
| 62 | Changelog dialog | âŒ | ĞŸĞ¾ĞºĞ°Ğ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸. Ref: `ChangelogDialog` |
| 63 | Auto-retry Ğ½Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ñ… ÑĞµÑ‚Ğ¸ | âŒ | ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¿Ñ€Ğ¸ ECONNRESET Ğ¸ Ñ‚.Ğ´. Ref: `AUTO_RETRY_CONFIG` |
| 64 | Tool result truncation | âŒ | ĞĞ±Ñ€ĞµĞ·ĞºĞ° Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ñ… Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² (20k chars). Ref: `message-service.js` |
| 65 | Streaming indicator (Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ñ) | âŒ | ĞĞ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ/ÑÑ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³Ğ°. Ref: `WaitingIndicator`, `BlinkingLogo` |
| 66 | Welcome screen | âŒ | Ğ­ĞºÑ€Ğ°Ğ½ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ñ Ğ±ĞµĞ· ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹. Ref: `WelcomeScreen` |
| 67 | Scroll-to-bottom floating button | âŒ | ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºĞ¸ Ğ²Ğ½Ğ¸Ğ·. Ref: `ScrollControl` |

---

### ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğ¹)

**Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµĞ¼ Ğ½Ğ°Ğ´ Tier 1 â€” Ğ¿Ğ¾ Ğ¿Ğ¾Ñ€ÑĞ´ĞºÑƒ:**

1. **#25 Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑĞµÑÑĞ¸Ğ¹** â€” save/load Ñ‡Ğ°Ñ‚Ğ¾Ğ² Ğ² JSONL
2. **#26 ĞŸĞ°Ğ½ĞµĞ»ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸** â€” sidebar ÑĞ¾ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼ ÑĞµÑÑĞ¸Ğ¹
3. **#27 Session resume** â€” Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½Ğ¸Ğµ ÑĞµÑÑĞ¸Ğ¸
4. **#28 Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ commit message** â€” VCS action
5. **#29 Quick Fix** â€” Ctrl+Shift+Q
6. **#30 Send File Path** â€” right-click action
7. **#31 Input history** â€” â†‘/â†“ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ
8. **#33 Undo file changes** â€” Ğ¾Ñ‚ĞºĞ°Ñ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹

ĞŸĞ¾ÑĞ»Ğµ Tier 1 Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ğ¼ Ğº Tier 2, Ğ·Ğ°Ñ‚ĞµĞ¼ Tier 3, Tier 4.