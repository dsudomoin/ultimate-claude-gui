# Plan: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤

## Context

–°–µ–π—á–∞—Å, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞, –æ–Ω–æ –º–æ–ª—á–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `ConcurrentLinkedQueue<String>`. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç, —á—Ç–æ –≤ –æ—á–µ—Ä–µ–¥–∏, –Ω–µ –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –æ—Ç—Ç—É–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∞ –ø—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ—Ä—è—é—Ç—Å—è (–æ—á–µ—Ä–µ–¥—å —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç). –ù—É–∂–Ω–æ: –≤–∏–∑—É–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å –æ—á–µ—Ä–µ–¥–∏ –Ω–∞–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥–∞ + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –ø—Ä–∏ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–µ –≤ –æ—á–µ—Ä–µ–¥—å.

## –í–∏–∑—É–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞

```
+----------------------------------------------------------+
|  [–°–∫—Ä–æ–ª–ª —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏]                                   |
+----------------------------------------------------------+
|  StatusPanel (todos/files/agents)                         |
+----------------------------------------------------------+
|  QueueDisplayPanel (–µ—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –Ω–µ –ø—É—Å—Ç–∞)                 |
|  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê |
|  ‚îÇ ‚è≥ –í –æ—á–µ—Ä–µ–¥–∏ (2)                                     ‚îÇ |
|  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ |
|  ‚îÇ #1  Fix the login bug                           [X]  ‚îÇ |
|  ‚îÇ #2  Update README  [üñº][üñº]                      [X]  ‚îÇ |
|  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò |
+----------------------------------------------------------+
|  ChatInputPanel (—Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ + —Ç—É–ª–±–∞—Ä)                 |
+----------------------------------------------------------+
```

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ù–æ–≤—ã–π —Ñ–∞–π–ª: `ui/queue/QueuedMessage.kt`

–î–∞—Ç–∞-–∫–ª–∞—Å—Å –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ –æ—á–µ—Ä–µ–¥–∏:
```kotlin
data class QueuedMessage(val text: String, val images: List<File> = emptyList())
```

### 2. –ù–æ–≤—ã–π —Ñ–∞–π–ª: `ui/queue/QueueDisplayPanel.kt`

Custom-painted –ø–∞–Ω–µ–ª—å –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É StatusPanel:
- **HeaderPanel** (26px): "–í –æ—á–µ—Ä–µ–¥–∏ (N)" —Å –∏–∫–æ–Ω–∫–æ–π, —Ñ–æ–Ω `surfaceTertiary`, —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ –≤–µ—Ä—Ö–Ω–∏–µ —É–≥–ª—ã
- **QueueRowPanel** (36px –Ω–∞ —Å—Ç—Ä–æ–∫—É): –±—ç–¥–∂ `#1`, –ø—Ä–µ–≤—å—é —Ç–µ–∫—Å—Ç–∞ (truncated), –º–∏–Ω–∏-–ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (24x24), –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è [X]
- –°–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å `borderNormal`
- –°–∫—Ä—ã—Ç–∞ –∫–æ–≥–¥–∞ –æ—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞ (`isVisible = false`)
- –•–æ–≤–µ—Ä-—ç—Ñ—Ñ–µ–∫—Ç—ã, –∫—É—Ä—Å–æ—Ä hand –Ω–∞ –∫–Ω–æ–ø–∫–µ —É–¥–∞–ª–µ–Ω–∏—è
- Thumbnail'—ã –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `ImageIO.read()` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç—Ä–æ–∫–∏

### 3. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `ChatPanel.kt`

**a) –¢–∏–ø –æ—á–µ—Ä–µ–¥–∏** (—Å—Ç—Ä–æ–∫–∞ 57):
```
ConcurrentLinkedQueue<String> ‚Üí ConcurrentLinkedQueue<QueuedMessage>
```

**b) `onSendMessage()`** (—Å—Ç—Ä–æ–∫–∏ 298-305): –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –æ—á–µ—Ä–µ–¥—å ‚Äî –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `inputPanel.consumeAttachedImages()` –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å:
```kotlin
val images = inputPanel.consumeAttachedImages()
messageQueue.add(QueuedMessage(text, images))
queuePanel.updateQueue(messageQueue.toList())
```

**c) `doSendMessage()`** (—Å—Ç—Ä–æ–∫–∏ 307+): –¥–æ–±–∞–≤–∏—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `preAttachedImages: List<File>? = null`. –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤–º–µ—Å—Ç–æ `inputPanel.consumeAttachedImages()`.

**d) `processQueue()`** (—Å—Ç—Ä–æ–∫–∏ 652-655): –ø–µ—Ä–µ–¥–∞—ë–º –∏ —Ç–µ–∫—Å—Ç –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
```kotlin
val next = messageQueue.poll() ?: return
queuePanel.updateQueue(messageQueue.toList())
doSendMessage(next.text, next.images)
```

**e) Layout** (—Å—Ç—Ä–æ–∫–∏ 181-186): –≤—Å—Ç–∞–≤–∏—Ç—å `queuePanel` –º–µ–∂–¥—É `statusPanel` –∏ `inputContainer`:
```kotlin
val aboveInputPanel = JPanel(BorderLayout()).apply {
    isOpaque = false
    add(statusPanel, BorderLayout.NORTH)
    add(queuePanel, BorderLayout.SOUTH)
}
val southPanel = JPanel(BorderLayout()).apply {
    isOpaque = false
    add(aboveInputPanel, BorderLayout.NORTH)
    add(inputContainer, BorderLayout.CENTER)
}
```

**f) `newChat()`** (—Å—Ç—Ä–æ–∫–∞ 663): –æ—á–∏—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –∏ —Å–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å.

**g) Callback —É–¥–∞–ª–µ–Ω–∏—è**: –ø—Ä–∏ –∫–ª–∏–∫–µ [X] ‚Äî —É–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏–∑ –æ—á–µ—Ä–µ–¥–∏ (—Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —á–µ—Ä–µ–∑ toMutableList + removeAt + clear + addAll).

### 4. i18n —Å—Ç—Ä–æ–∫–∏

`MyMessageBundle.properties`:
```
queue.title=Queued ({0})
```
`MyMessageBundle_ru.properties`:
```
queue.title=–í –æ—á–µ—Ä–µ–¥–∏ ({0})
```

## –§–∞–π–ª—ã

| –§–∞–π–ª | –î–µ–π—Å—Ç–≤–∏–µ |
|------|----------|
| `ui/queue/QueuedMessage.kt` | –°–æ–∑–¥–∞—Ç—å |
| `ui/queue/QueueDisplayPanel.kt` | –°–æ–∑–¥–∞—Ç—å |
| `ui/chat/ChatPanel.kt` | –ò–∑–º–µ–Ω–∏—Ç—å (–æ—á–µ—Ä–µ–¥—å, layout, callbacks) |
| `messages/MyMessageBundle.properties` | –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ |
| `messages/MyMessageBundle_ru.properties` | –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ |

## –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–ª–∞–≥–∏–Ω, –Ω–∞—á–∞—Ç—å —á–∞—Ç
2. –í–æ –≤—Ä–µ–º—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å 2-3 —Å–æ–æ–±—â–µ–Ω–∏—è ‚Äî –ø–∞–Ω–µ–ª—å –æ—á–µ—Ä–µ–¥–∏ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è
3. –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –∫ —Å–æ–æ–±—â–µ–Ω–∏—é –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ –≤—Ä–µ–º—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ ‚Äî thumbnail –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏
4. –ù–∞–∂–∞—Ç—å [X] ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å—Å—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏
5. –ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ ‚Äî —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –ø–æ –ø–æ—Ä—è–¥–∫—É —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
6. –ü—Ä–∏ –ø—É—Å—Ç–æ–π –æ—á–µ—Ä–µ–¥–∏ –ø–∞–Ω–µ–ª—å –Ω–µ –≤–∏–¥–Ω–∞
